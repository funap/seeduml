"use strict";var seeduml=(()=>{var ct=Object.defineProperty;var pt=Object.getOwnPropertyDescriptor;var ft=Object.getOwnPropertyNames;var ut=Object.prototype.hasOwnProperty;var mt=(q,r)=>{for(var t in r)ct(q,t,{get:r[t],enumerable:!0})},gt=(q,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ft(r))!ut.call(q,i)&&i!==t&&ct(q,i,{get:()=>r[i],enumerable:!(e=pt(r,i))||e.enumerable});return q};var $t=q=>gt(ct({},"__esModule",{value:!0}),q);var yt={};mt(yt,{default:()=>xt,initialize:()=>lt,renderAll:()=>_,renderSequenceDiagram:()=>nt});var V=class{constructor(){this.type="sequence";this.participants=[];this.messages=[];this.activations=[];this.groups=[];this.references=[];this.notes=[];this.dividers=[];this.delays=[];this.spacings=[];this.timeConstraints=[];this.taggedSteps=new Map;this.hideFootbox=!1;this.currentStep=0;this.groupStack=[];this.autonumberConfig=null;this.currentAutonumber=0;this.autoactivateEnabled=!1}setHideFootbox(r){this.hideFootbox=r}addParticipant(r,t,e="participant",i,n,a){let o=this.participants.find(c=>c.name===r);o?(t&&(o.label=t),e!=="participant"&&(o.type=e),i!==void 0&&(o.order=i),n&&(o.color=n),a&&(o.stereotype=a)):(o={name:r,label:t,type:e,order:i,color:n,stereotype:a},this.participants.push(o)),this.groupStack.forEach(c=>{c.participants.includes(r)||c.participants.push(r)})}addMessage(r,t,e,i="arrow",n="default",a,o,c="none"){let s=this.currentStep++;this.addParticipant(r),this.addParticipant(t);let l;return this.autonumberConfig&&(l=this.currentAutonumber.toString(),this.currentAutonumber+=this.autonumberConfig.increment),this.messages.push({from:r,to:t,text:e,type:i,step:s,arrowHead:n,startHead:c,color:a,bidirectional:o,number:l}),this.autoactivateEnabled&&r!==t&&i==="arrow"&&this.activate(t,s,s),s}setAutonumber(r=1,t=1,e){this.autonumberConfig={start:r,increment:t,format:e},this.currentAutonumber=r}setAutoactivate(r){this.autoactivateEnabled=r}destroy(r,t){let e=this.participants.find(i=>i.name===r);e&&(e.destroyedStep=t!==void 0?t:this.currentStep++,this.deactivate(r,e.destroyedStep))}create(r,t){let e=this.participants.find(i=>i.name===r);e&&(e.createdStep=t)}addDivider(r){this.dividers.push({label:r,step:this.currentStep++})}rewindStep(){this.currentStep>0&&this.currentStep--}nextStep(){return this.currentStep++}getCurrentStep(){return this.currentStep}addDelay(r){this.delays.push({text:r,step:this.currentStep++})}addSpacing(r=30){this.spacings.push({height:r,step:this.currentStep++})}setTitle(r){this.title=r}setHeader(r){this.header=r}setFooter(r){this.footer=r}returnMessage(r){let t=[...this.activations].reverse().find(a=>a.endStep===void 0);if(!t)return;let e=t.participantName,i=e;if(t.sourceStep!==void 0){let a=this.messages.find(o=>o.step===t.sourceStep);a&&(i=a.from)}let n=this.addMessage(e,i,r,"dotted","open");this.deactivate(e,n)}addNote(r,t,e,i,n="folder",a){let o=a!==void 0?a:this.currentStep++,c=this.groupStack.length>0?this.groupStack[this.groupStack.length-1]:void 0;return this.notes.push({text:r,position:t,participants:e,step:o,color:i,shape:n,owner:c}),o}activate(r,t=this.currentStep,e,i){this.addParticipant(r);let n=this.activations.filter(a=>a.participantName===r&&a.endStep===void 0).length;this.activations.push({participantName:r,startStep:t,level:n,sourceStep:e,color:i})}deactivate(r,t=this.currentStep,e){this.addParticipant(r);let i=[...this.activations].reverse().find(n=>n.participantName===r&&n.endStep===void 0);i&&(i.endStep=t,i.endSourceStep=e)}startGroup(r,t){let e=this.nextStep(),i={type:r,label:t,startStep:e,sections:[],level:this.groupStack.length,participants:[]};return this.groups.push(i),this.groupStack.push(i),i}addGroupSection(r){let t=this.groupStack[this.groupStack.length-1];t&&t.sections.push({label:r,startStep:this.nextStep()})}endGroup(){let r=this.groupStack.pop();r&&(r.endStep=this.nextStep())}addReference(r,t){let e=this.nextStep(),i=this.nextStep();this.references.push({participants:r,label:t,startStep:e,endStep:i})}addTaggedStep(r,t){this.taggedSteps.set(r,t)}addTimeConstraint(r,t,e){this.timeConstraints.push({startTag:r,endTag:t,label:e})}};var tt=class{parse(r){let t=new V,e=r.split(`
`),i=null,n=null,a=-1,o="",c="",s="",l=new Map;for(let f=0;f<e.length;f++){let h=e[f],d=h;if(h=h.trim(),!h||h.startsWith("@")||h.startsWith("!pragma"))continue;if(n){let y=h.toLowerCase();if(y.startsWith("end note")||(y==="end hnote"||y==="endhnote")||(y==="end rnote"||y==="endrnote")||(y==="end bnote"||y==="endbnote")){let v=n.position.toLowerCase(),G;if(n.participants.length===0&&(v==="right"||v==="left")&&o&&c){let W=t.participants.findIndex(N=>N.name===o),A=t.participants.findIndex(N=>N.name===c);if(W!==-1&&A!==-1){let N=t.participants[W],O=t.participants[A],Y=W<A;N.order!==void 0&&O.order!==void 0&&(Y=N.order<O.order),v==="left"?n.participants=[Y?o:c]:n.participants=[Y?c:o]}else n.participants=[c];a!==-1&&(G=a)}let H=n.text.join(`
`).replace(/\\n/g,`
`);t.addNote(H,n.position,n.participants,n.color,n.shape,G),n=null}else n.text.push(d);continue}if(i){h.toLowerCase().startsWith("end ref")?(t.addReference(i.participants,i.label.join(`
`)),i=null):i.label.push(d);continue}if(h.startsWith("'"))continue;let m=!1;h.startsWith("/")&&(m=!0,h=h.substring(1).trim(),t.rewindStep());let u=h.match(/^create\s+(?:(actor|boundary|control|entity|database|collections)\s+)?(\w+)$/i);if(u){let[,y,x]=u;t.addParticipant(x,y),t.create(x,t.getCurrentStep());continue}let p=h.match(/^(activate|deactivate|destroy)\s+(".*?"|\w+)(?:\s+(#\w+))?$/i);if(p){let[,y,x,C]=p,M=x.replace(/^"(.*)"$/,"$1");if(C&&C.startsWith("#")){let v=C.substring(1);/^[0-9A-Fa-f]+$/.test(v)&&[3,4,6,8].includes(v.length)||(C=v)}let B=y.toLowerCase();if(B==="activate")if(M===c&&a!==-1)t.activate(M,a,a,C),l.set(M,a);else{let v=t.nextStep();t.activate(M,v,void 0,C),l.set(M,v)}else if(B==="deactivate"){let v=!1;a!==-1&&a>(l.get(M)??-1)&&(s==="arrow"?v=M===c||M===o:s==="dotted"&&(v=M===o)),v?t.deactivate(M,a):t.deactivate(M,t.nextStep())}else if(B==="destroy"){let v=!1;a!==-1&&a>(l.get(M)??-1)&&(s==="arrow"?v=M===c||M===o:s==="dotted"&&(v=M===o)),v?t.destroy(M,a):t.destroy(M,t.nextStep())}continue}let g=h.match(/^\{(\w+)\}\s*<->\s*\{(\w+)\}(?:\s*:\s*(.*))?$/);if(g){let[,y,x,C]=g;t.addTimeConstraint(y,x,C||"");continue}let $=h.match(/^\.\.\.(?:\s*(.*?)\s*\.\.\.)?$/);if($){let[,y]=$;t.addDelay(y||void 0);continue}let k=h.match(/^(?:\{(\w+)\}\s+)?(".*?"|\w+|x|\[|\])?\s*([<ox\\/]*)([-.]+)(?:\[(#\w+)\])?([-.]*)([>ox\\/]*)?\s*(".*?"|\w+|x|\[|\])?\s*(--\+\+|\+\+--|--|\+\+|\*\*|!!)?(?:\s+(#\w+))?(?:\s*:\s*(.*))?$/i);if(k){let[,y,x,C,M,B,v,G,H,W,A,N]=k;N=N||"";let O=M+(v||"");if(O.length>0){x&&(x=x.replace(/^"(.*)"$/,"$1")),H&&(H=H.replace(/^"(.*)"$/,"$1")),(!x||x==="[")&&(x="["),(!H||H==="]")&&(H="]");let Y=O.includes("..")||O.includes("--"),U=C.includes("<")&&(G||"").includes(">"),j=(z,at)=>z?z===">"||z==="<"?"default":z===">>"||z==="<<"?"open":z==="\\"||z==="/"?"half":z==="\\\\"||z==="//"?"open":z.includes("x")?"lost":z.includes("o")?"arrow-circle":"default":"none",J=j(G||"",!1),K=j(C||"",!0);G==="x"&&(J="lost"),x==="x"&&(K="found");let dt=N.replace(/\\n/g,`
`),T=t.addMessage(x,H,dt,Y?"dotted":"arrow",J,B,U,K);y&&t.addTaggedStep(y,T);let st=x,ot=H,Q=z=>["default","open","half","arrow-circle"].includes(z);if(Q(K)&&!Q(J)?(st=H,ot=x):Q(J)&&!Q(K)&&(st=x,ot=H),a=T,o=st,c=ot,s=Y?"dotted":"arrow",W==="++"){if(A&&A.startsWith("#")){let z=A.substring(1);/^[0-9A-Fa-f]+$/.test(z)&&[3,4,6,8].includes(z.length)||(A=z)}t.activate(H,T,T,A),l.set(H,T)}else if(W==="--")t.deactivate(x,T,T);else if(W==="--++"){if(t.deactivate(x,T,T),A&&A.startsWith("#")){let z=A.substring(1);/^[0-9A-Fa-f]+$/.test(z)&&[3,4,6,8].includes(z.length)||(A=z)}t.activate(H,T,T,A),l.set(H,T)}else if(W==="++--"){if(A&&A.startsWith("#")){let z=A.substring(1);/^[0-9A-Fa-f]+$/.test(z)&&[3,4,6,8].includes(z.length)||(A=z)}t.activate(x,T,T,A),l.set(x,T),t.deactivate(H,T,T)}else W==="**"?t.create(H,T):W==="!!"&&t.destroy(H,T);continue}}let D=h.match(/^(h|r|b)?note\s+(left|right|over|across)(?:\s+(?:of\s+)?([^#:]+))?\s*(#\w+)?\s*(?::\s*(.*))?$/i);if(D){let[,y,x,C,M,B]=D,v=[];C&&C.trim()&&(v=C.split(",").map(H=>H.trim().replace(/^"(.*)"$/,"$1")));let G="folder";if(y==="h"?G="hexagon":y==="r"?G="rectangle":y==="b"&&(G="bubble"),B!==void 0){let H=x.toLowerCase(),W;if(v.length===0&&(H==="right"||H==="left")&&o&&c){let N=t.participants.findIndex(Y=>Y.name===o),O=t.participants.findIndex(Y=>Y.name===c);if(N!==-1&&O!==-1){let Y=t.participants[N],U=t.participants[O],j=N<O;Y.order!==void 0&&U.order!==void 0&&(j=Y.order<U.order),H==="left"?v=[j?o:c]:v=[j?c:o]}else v=[c];a!==-1&&(W=a)}let A=B.replace(/\\n/g,`
`);t.addNote(A,x.toLowerCase(),v,M,G,W)}else n={text:[],position:x.toLowerCase(),participants:v,color:M,shape:G};continue}let E=h.match(/^(alt|opt|loop|par|break|critical|group)(?:\s+(.*))?$/i);if(E){let[,y,x]=E;t.startGroup(y.toLowerCase(),x||"");continue}let b=h.match(/^else(?:\s+(.*))?$/i);if(b){let[,y]=b;t.addGroupSection(y||"");continue}if(h.toLowerCase().startsWith("end")){t.endGroup();continue}let L=h.match(/^ref\s+over\s+(.*?)(?:\s*:\s*(.*))?$/i);if(L){let[,y,x]=L,C=y.split(",").map(M=>M.trim().replace(/^"(.*)"$/,"$1"));x?t.addReference(C,x):i={participants:C,label:[]};continue}let w=h.match(/^return(?:\s+(.*))?$/i);if(w){let[,y]=w,x=(y||"").replace(/\\n/g,`
`);t.returnMessage(x);continue}let S=h.match(/^autonumber(?:\s+(\d+))?(?:\s+(\d+))?(?:\s+"(.*?)"|)$/i);if(S){let[,y,x,C]=S;t.setAutonumber(y?parseInt(y,10):1,x?parseInt(x,10):1,C);continue}let R=h.match(/^autoactivate\s+(on|off)$/i);if(R){t.setAutoactivate(R[1].toLowerCase()==="on");continue}let F=h.match(/^==\s*(.*?)\s*==$/);if(F){t.addDivider(F[1]);continue}if(h==="|||"){t.addSpacing();continue}let I=h.match(/^\|\|(\d+)\|\|$/);if(I){t.addSpacing(parseInt(I[1],10));continue}let P=h.match(/^(title|header|footer)\s+(.*)$/i);if(P){let[,y,x]=P;y.toLowerCase()==="title"?t.setTitle(x):y.toLowerCase()==="header"?t.setHeader(x):y.toLowerCase()==="footer"&&t.setFooter(x);continue}if(h.toLowerCase()==="hide footbox"){t.setHideFootbox(!0);continue}let Z="(participant|actor|boundary|control|entity|database|collections|queue)",X=new RegExp(`^${Z}\\s+(".*?"|\\w+)\\s*(?:<<\\s*(.*?)\\s*>>)?(?:\\s+as\\s+(".*?"|\\w+))?\\s*(?:<<\\s*(.*?)\\s*>>)?(?:\\s+order\\s+(\\d+))?(?:\\s+(#\\w+))?$`,"i"),rt=h.match(X);if(rt){let[,y,x,C,M,B,v,G]=rt;if(!y||!x)continue;let H=C||B,W,A;M?M.startsWith('"')?(W=x.replace(/^"(.*)"$/,"$1"),A=M.replace(/^"(.*)"$/,"$1")):(W=M.replace(/^"(.*)"$/,"$1"),A=x.replace(/^"(.*)"$/,"$1")):(W=x.replace(/^"(.*)"$/,"$1"),A=void 0);let N=v?parseInt(v,10):void 0;t.addParticipant(W,A,y.toLowerCase(),N,G,H);continue}if(d.trim()!==""&&!d.trim().startsWith("'"))throw new Error(`Syntax error at line ${f+1}: ${h}`)}return t}};var ht={padding:40,participantWidth:120,participantHeight:40,participantGap:180,defaultMessageGap:50,fontSize:14,activationWidth:12,colors:{defaultStroke:"#333333",defaultFill:"#eeeeee",actorFill:"#f8f9fa",noteFill:"#ffffcc",line:"#666666",text:"#000000"},fontFamily:"sans-serif"};var et=class{constructor(r){this.theme=r}calculateLayout(r){let t=[...r.participants].sort((E,b)=>E.order!==void 0&&b.order!==void 0?E.order-b.order:E.order!==void 0?-1:b.order!==void 0?1:0),e=this.calculateMaxStep(r);this.finalizeEndSteps(r,e);let i=this.calculateStepHeights(r,e),n=i.stepY,a=i.totalHeight,o=t.map(E=>this.calculateParticipantWidth(E)),c=this.calculateGaps(r,t,o),s=this.calculateRelativepCenterXs(t,o,c),l=this.preCalculateNoteLayouts(r,t,s,o,n),f=this.calculateBounds(t,s,o,l,r.messages),h=this.theme.padding-f.minX,d=f.maxX-f.minX+this.theme.padding*2,m=d;if(r.timeConstraints.length>0){let b=50+Math.max(...r.timeConstraints.map(L=>L.label.length),0)*8;m+=b}let u=r.hideFootbox?0:this.theme.participantHeight+20,p=a+u+this.theme.padding,g=t.map((E,b)=>{let L=s[b]+h;return{participant:E,centerX:L,x:L-o[b]/2,y:E.createdStep!==void 0?n[E.createdStep]-this.theme.participantHeight/2:this.theme.padding,width:o[b],height:this.theme.participantHeight,destroyedY:E.destroyedStep!==void 0?n[E.destroyedStep]:void 0}}),$=[];l.forEach((E,b)=>{let L=E.x+h,w=E.width;b.position==="across"&&(L=this.theme.padding,w=Math.max(d-this.theme.padding*2,E.width)),$.push({note:b,x:L,y:E.y,width:w,height:E.height})});let k=this.calculateGroupLayouts(r,g,$,n,e),D=this.calculateActivationLayouts(r,g,n,r.messages);return{width:m,height:p,participants:g,notes:$,dividers:this.calculateDividerLayouts(r,n,m),references:this.calculateReferenceLayouts(r,g,n),messages:this.calculateMessageLayouts(r,g,n,D),groups:k,activations:D,delays:this.calculateDelayLayouts(r,n),timeConstraints:this.calculateTimeConstraintLayouts(r,g,n,d)}}calculateMessageLayouts(r,t,e,i){return r.messages.map(n=>{let a=t.findIndex(d=>d.participant.name===n.from),o=t.findIndex(d=>d.participant.name===n.to),c=e[n.step],s=a!==-1?t[a].centerX:0,l=o!==-1?t[o].centerX:0;if(a!==-1&&o!==-1){let d=i.filter(u=>u.activation.participantName===n.from&&u.activation.startStep<=n.step&&(u.activation.endStep??1/0)>=n.step).sort((u,p)=>p.activation.level-u.activation.level),m=i.filter(u=>u.activation.participantName===n.to&&u.activation.startStep<=n.step&&(u.activation.endStep??1/0)>=n.step).sort((u,p)=>p.activation.level-u.activation.level);a!==o&&(a<o?(d.length>0&&(s=d[0].x+d[0].width),m.length>0&&(l=m[0].x)):(d.length>0&&(s=d[0].x),m.length>0&&(l=m[0].x+m[0].width)))}o!==-1&&t[o].participant.createdStep===n.step&&(l=t[o].x);let f=[{x:s,y:c},{x:l,y:c}],h={x:(s+l)/2,y:c};if(a===o&&a!==-1){let d=i.filter(p=>p.activation.participantName===n.from&&p.activation.startStep<=n.step&&(p.activation.endStep??1/0)>=n.step).sort((p,g)=>g.activation.level-p.activation.level),m=0,u=0;if(d.length>0){let p=d[0];p.activation.startStep===n.step?d.length>1?(m=1,u=0):(m=void 0,u=0):p.activation.endStep===n.step&&(d.length>1?(m=0,u=1):(m=0,u=void 0));let g=m!==void 0&&d.length>m?d[m].x+d[m].width:t[a].centerX,$=u!==void 0&&d.length>u?d[u].x+d[u].width:t[a].centerX,k=40;f[0]={x:g,y:c},f[1]={x:Math.max(g,$)+k,y:c},f.push({x:Math.max(g,$)+k,y:c+25}),f.push({x:$,y:c+25}),h={x:Math.max(g,$)+k+5,y:c+10}}else{let p=t[a].centerX,g=40;f[0]={x:p,y:c},f[1]={x:p+g,y:c},f.push({x:p+g,y:c+25}),f.push({x:p,y:c+25}),h={x:p+g+5,y:c+10}}}return{message:n,y:c,points:f,labelPosition:h,lineStyle:n.type==="dotted"?"dashed":"solid"}})}calculateDividerLayouts(r,t,e){return r.dividers.map(i=>({y:t[i.step],label:i.label}))}calculateDelayLayouts(r,t){return r.delays.map(e=>({y:t[e.step],text:e.text}))}calculateTimeConstraintLayouts(r,t,e,i){return r.timeConstraints.map(n=>{let a=r.taggedSteps.get(n.startTag),o=r.taggedSteps.get(n.endTag);return a===void 0||o===void 0?null:{x:i-this.theme.padding+20,startY:e[a],endY:e[o],label:n.label}}).filter(n=>n!==null)}calculateReferenceLayouts(r,t,e){return r.references.map(i=>{let n=i.participants.map(h=>t.findIndex(d=>d.participant.name===h)).filter(h=>h!==-1);if(n.length===0)return null;let a=Math.min(...n),o=Math.max(...n),c=t[a].x,s=t[o].x+t[o].width-c,l=e[i.startStep]-10,f=e[i.endStep]-l;return{reference:i,x:c,y:l,width:s,height:f}}).filter(i=>i!==null)}calculateActivationLayouts(r,t,e,i){return r.activations.map(n=>{let a=t.findIndex(d=>d.participant.name===n.participantName);if(a===-1)return null;let c=t[a].centerX-this.theme.activationWidth/2+n.level*5,s=e[n.startStep];if(n.sourceStep!==void 0){let d=i.find(m=>m.step===n.sourceStep);d&&d.from===n.participantName&&d.to===n.participantName&&(s+=25)}let l=e[n.endStep];if(n.endSourceStep!==void 0){let d=i.find(m=>m.step===n.endSourceStep);d&&d.from===n.participantName&&d.to===n.participantName&&(l+=25)}let h=Math.max(5,l-s);return{activation:n,x:c,y:s,width:this.theme.activationWidth,height:h}}).filter(n=>n!==null)}calculateMaxStep(r){let t=0;return[...r.messages,...r.activations,...r.groups,...r.references,...r.notes,...r.dividers,...r.delays,...r.spacings].forEach(i=>{let n=i.step??i.startStep??i.endStep??0;n>t&&(t=n)}),t+1}finalizeEndSteps(r,t){r.activations.forEach(e=>{e.endStep===void 0&&(e.endStep=t)}),r.groups.forEach(e=>{e.endStep===void 0&&(e.endStep=t)})}calculateStepHeights(r,t){let e=new Array(t+1).fill(this.theme.defaultMessageGap),i=new Array(t+2).fill(0),n=new Array(t+2).fill(0);r.notes.forEach(s=>{let f=s.text.split(`
`).length*20+10;i[s.step]=Math.max(i[s.step],f/2),n[s.step]=Math.max(n[s.step],f/2)}),r.messages.forEach(s=>{let f=s.text.split(`
`).length;if(s.from===s.to){let h=Math.max(25,f*20);i[s.step]=Math.max(i[s.step],0),n[s.step]=Math.max(n[s.step],h+10)}else{let h=f*15+5;i[s.step]=Math.max(i[s.step],h),n[s.step]=Math.max(n[s.step],0)}});let a=new Array(t+1).fill(this.theme.defaultMessageGap);r.dividers.forEach(s=>{a[s.step]=30}),r.delays.forEach(s=>{a[s.step]=40}),r.spacings.forEach(s=>{a[s.step]=s.height}),r.references.forEach(s=>{let f=s.label.split(`
`).length*15+40;s.endStep===s.startStep+1&&(a[s.startStep]=Math.max(a[s.startStep],f))});for(let s=0;s<=t;s++){let l=n[s]+i[s+1]+10;e[s]=Math.max(a[s],l)}let o=new Array(t+1).fill(0),c=this.theme.padding+90;for(let s=0;s<=t;s++)o[s]=c,c+=e[s];return{stepY:o,totalHeight:c}}calculateParticipantWidth(r){let e=(r.label||r.name).replace(/\\n/g,`
`).split(`
`),i=Math.max(...e.map(n=>n.length));return Math.max(this.theme.participantWidth,i*9+30)}calculateGaps(r,t,e){let i=Math.max(0,t.length-1),n=new Array(i).fill(60),a=this.calculateMaxStep(r);for(let o=0;o<=a;o++){let c=new Array(i).fill(0);for(let s=0;s<t.length;s++){let l=t[s].name;if(t[s].createdStep===o){let $=e[s];s<i&&(c[s]=Math.max(c[s],$/2+20))}let h=15,d=r.messages.find($=>$.step===o&&$.from===l&&$.to===l);d&&(h=40+(Math.max(...d.text.split(`
`).map(k=>k.length*8))+20)+10);let m=r.activations.filter($=>$.participantName===l&&$.startStep<=o&&($.endStep??1/0)>=o);if(m.length>0){let $=Math.max(...m.map(k=>k.level));h=Math.max(h,this.theme.activationWidth/2+$*5+10)}r.notes.filter($=>$.step===o&&$.position==="right"&&$.participants?.includes(l)).forEach($=>{let k=Math.max(60,Math.max(...$.text.split(`
`).map(D=>D.length*8.5))+20);h+=k+10}),s<i&&(c[s]+=h);let p=15;r.notes.filter($=>$.step===o&&$.position==="left"&&$.participants?.includes(l)).forEach($=>{let k=Math.max(60,Math.max(...$.text.split(`
`).map(D=>D.length*8.5))+20);p+=k+10}),s>0&&(c[s-1]+=p)}for(let s=0;s<i;s++)n[s]=Math.max(n[s],c[s])}return r.messages.forEach(o=>{let c=t.findIndex(m=>m.name===o.from),s=t.findIndex(m=>m.name===o.to);if(c===-1||s===-1||c===s)return;let l=Math.max(...o.text.split(`
`).map(m=>m.length*8))+20,f=Math.min(c,s),h=Math.max(c,s),d=0;for(let m=f;m<h;m++)d+=e[m]/2+n[m]+e[m+1]/2;if(d<l){let u=(l-d)/(h-f);for(let p=f;p<h;p++)n[p]+=u}}),r.notes.forEach(o=>{if(o.position!=="over"&&o.position!=="across")return;let c=o.text.split(`
`),s=Math.max(60,Math.max(...c.map(l=>l.length*8.5))+20);if(o.participants&&o.participants.length>0){let l=t.findIndex(m=>m.name===o.participants[0]),f=o.participants.length>1?t.findIndex(m=>m.name===o.participants[1]):l;if(l===-1||f===-1)return;let h=Math.min(l,f),d=Math.max(l,f);if(h===d){let m=s/2+10;h<i&&n[h]<m&&(n[h]=m)}else{let m=0;for(let u=h;u<d;u++)m+=e[u]/2+n[u]+e[u+1]/2;if(m<s){let p=(s-m)/(d-h);for(let g=h;g<d;g++)n[g]+=p}}}}),n}calculateRelativepCenterXs(r,t,e){let i=new Array(r.length).fill(0);return r.forEach((n,a)=>{a===0?i[a]=t[a]/2:i[a]=i[a-1]+t[a-1]/2+e[a-1]+t[a]/2}),i}preCalculateNoteLayouts(r,t,e,i,n){let a=new Map,o=new Map;return r.notes.forEach(c=>{let s=c.text.split(`
`),l=Math.max(...s.map(p=>p.length*8.5))+20,h=Math.max(l,60),d=s.length*20+10,m=n[c.step]-d/2,u=0;if(c.position==="across")u=0,a.set(c,{x:u,y:m,width:h,height:d});else if(c.position==="over"){let p=c.participants.map(g=>t.findIndex($=>$.name===g)).filter(g=>g!==-1);if(p.length>0){let g=Math.min(...p),$=Math.max(...p),k=e[$]+i[$]/2-(e[g]-i[g]/2),D=Math.max(k,h);u=e[g]-i[g]/2-(D-k)/2,a.set(c,{x:u,y:m,width:D,height:d})}}else{let p=(c.participants||[]).map(g=>t.findIndex($=>$.name===g)).filter(g=>g!==-1);if(p.length>0){let g=c.position==="left"?Math.min(...p):Math.max(...p),$=e[g],k=`${c.step}-${g}-${c.position}`,D=t[g],E=i[g]/2,L=c.step===D.createdStep?E:0;if(c.position==="left")u=(o.get(k)??$-L-5)-h,o.set(k,u-10);else{let w=r.messages.find(X=>X.step===c.step&&X.from===D.name&&X.to===D.name),S=0;if(w){let X=w.text.split(`
`);S=40+(Math.max(...X.map(y=>y.length*8))+20)}let R=r.activations.filter(X=>X.participantName===D.name&&X.startStep<=c.step&&(X.endStep??1/0)>=c.step),F=R.length>0?Math.max(...R.map(X=>X.level)):0,I=this.theme.activationWidth/2+F*5,P=Math.max(L,I,S);u=o.get(k)??$+P+5,o.set(k,u+h+10)}a.set(c,{x:u,y:m,width:h,height:d})}}}),a}calculateBounds(r,t,e,i,n){let a=0,o=0;return r.forEach((c,s)=>{let l=t[s]-e[s]/2,f=t[s]+e[s]/2;s===0?(a=l,o=f):(l<a&&(a=l),f>o&&(o=f))}),i.forEach(c=>{c.x<a&&(a=c.x),c.x+c.width>o&&(o=c.x+c.width)}),n.forEach(c=>{let s=r.findIndex(d=>d.name===c.from),l=r.findIndex(d=>d.name===c.to);if(s===-1||l===-1)return;let f=c.text.split(`
`),h=Math.max(...f.map(d=>d.length*8))+20;if(s===l){let d=t[s],m=Math.max(...c.text.split(`
`).map(p=>p.length*8))+20,u=d+40+m+10;u>o&&(o=u)}else{let d=t[s],m=t[l],u=(d+m)/2,p=u-h/2,g=u+h/2;p<a&&(a=p),g>o&&(o=g)}}),{minX:a,maxX:o}}calculateGroupLayouts(r,t,e,i,n){let a=r.groups.length>0?Math.max(...r.groups.map(o=>o.level)):0;return r.groups.map(o=>{let c=o.participants.map(b=>t.findIndex(L=>L.participant.name===b)).filter(b=>b!==-1);if(c.length===0)return null;let s=Math.min(...c),l=Math.max(...c),f=a-o.level,h=10+f*10,d=25+f*8,m=5+f*8,u=t[s].x+t[s].width/2-t[s].width/2-h,p=t[s].x-h,g=t[l].x+t[l].width+h-p;e.filter(b=>{let L=b.note;if(L.step<o.startStep||L.step>(o.endStep||n))return!1;let w=L.owner;if(!w)return!1;if(w===o)return!0;let S=w.endStep??n,R=o.endStep??n;return w.startStep>=o.startStep&&S<=R}).forEach(b=>{let L=b.note;if(L.position==="right"){let w=(L.participants||[]).map(S=>t.findIndex(R=>R.participant.name===S)).filter(S=>S!==-1);if(w.length>0&&Math.max(...w)===l){let S=b.x+b.width,R=p+g;S+10>R&&(g=S+10-p)}}else if(L.position==="left"){let w=(L.participants||[]).map(S=>t.findIndex(R=>R.participant.name===S)).filter(S=>S!==-1);if(w.length>0&&Math.min(...w)===s){let S=b.x,R=p;if(S-10<R){let F=R-(S-10);p-=F,g+=F}}}});let k=i[o.startStep]-d,D=i[o.endStep]+m,E=o.sections.map(b=>({label:b.label,y:i[b.startStep]}));return{group:o,x:p,y:k,width:g,height:D-k,type:o.type,label:o.label,sections:E}}).filter(o=>o!==null)}};var it=class{constructor(){this.theme=ht;this.lastSvg="";this.layoutEngine=new et(this.theme)}render(r){this.ensureParticipants(r);let t=this.layoutEngine.calculateLayout(r);return this.generateSvg(r,t)}ensureParticipants(r){r.notes.forEach(t=>{t.participants&&t.participants.forEach(e=>r.addParticipant(e))})}generateSvg(r,t){let e=`<svg width="${t.width}" height="${t.height}" viewBox="0 0 ${t.width} ${t.height}" xmlns="http://www.w3.org/2000/svg" style="background: white; font-family: ${this.theme.fontFamily};">`;return e+=this.renderDefs(r),e+=this.renderLifelines(r,t),e+=this.renderActivations(r,t),e+=this.renderGroups(t),e+=this.renderParticipants(r,t),e+=this.renderReferences(r,t),e+=this.renderNotes(t),e+=this.renderMessages(r,t),e+=this.renderDividers(r,t),e+=this.renderDelays(r,t),e+=this.renderTimeConstraints(t),e+=this.renderDestructionMarks(t),r.title&&(e+=`<text x="${t.width/2}" y="25" text-anchor="middle" font-size="${this.theme.fontSize+4}" font-weight="bold">${r.title}</text>`),r.header&&(e+=`<text x="${t.width-this.theme.padding}" y="15" text-anchor="end" font-size="${this.theme.fontSize-4}">${r.header}</text>`),r.footer&&(e+=`<text x="${t.width/2}" y="${t.height-10}" text-anchor="middle" font-size="${this.theme.fontSize-4}">${r.footer}</text>`),e+="</svg>",e}renderDefs(r){let t=new Set;t.add(this.theme.colors.defaultStroke),r.messages.forEach(i=>{t.add(this.normalizeColor(i.color,this.theme.colors.defaultStroke))});let e="<defs>";return t.forEach(i=>{let n=i.replace("#","");e+=`
      <marker id="arrowhead-${n}" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="${i}" />
      </marker>
      <marker id="arrowhead-reverse-${n}" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
        <polygon points="10 0, 0 3.5, 10 7" fill="${i}" />
      </marker>
      <marker id="arrowhead-open-${n}" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <path d="M 0 0 L 10 3.5 L 0 7" fill="none" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="arrowhead-open-reverse-${n}" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
        <path d="M 10 0 L 0 3.5 L 10 7" fill="none" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="halfhead-${n}" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 3.5" fill="${i}" />
      </marker>
      <marker id="halfhead-reverse-${n}" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
        <polygon points="10 0, 0 3.5, 10 3.5" fill="${i}" />
      </marker>
      <marker id="circlehead-${n}" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
        <circle cx="4" cy="4" r="3" fill="white" stroke="${i}" stroke-width="1.5" />
      </marker>
      <marker id="arrowhead-circle-${n}" markerWidth="18" markerHeight="7.5" refX="14" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="${i}" />
        <circle cx="14" cy="3.5" r="3" fill="${i}" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="arrowhead-circle-reverse-${n}" markerWidth="18" markerHeight="7.5" refX="4" refY="3.5" orient="auto">
        <polygon points="17 0, 7 3.5, 17 7" fill="${i}" />
        <circle cx="4" cy="3.5" r="3" fill="${i}" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="losthead-${n}" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
        <line x1="0" y1="0" x2="10" y2="10" stroke="${i}" stroke-width="2" />
        <line x1="10" y1="0" x2="0" y2="10" stroke="${i}" stroke-width="2" />
      </marker>`}),e+="</defs>",e}renderLifelines(r,t){let e="";return t.participants.forEach(i=>{if(i.participant.name==="["||i.participant.name==="]")return;let n=i.centerX,a=i.destroyedY!==void 0?i.destroyedY:r.hideFootbox?t.height-this.theme.padding:t.height-this.theme.padding-this.theme.participantHeight;e+=`<line x1="${n}" y1="${i.y+i.height}" x2="${n}" y2="${a}" stroke="${this.theme.colors.line}" stroke-dasharray="4" />`}),e}renderDestructionMarks(r){let t="";return r.participants.forEach(e=>{if(e.destroyedY!==void 0){let i=e.centerX,n=e.destroyedY,a=12;t+=`<line x1="${i-a}" y1="${n-a}" x2="${i+a}" y2="${n+a}" stroke="#FF0000" stroke-width="3" />`,t+=`<line x1="${i+a}" y1="${n-a}" x2="${i-a}" y2="${n+a}" stroke="#FF0000" stroke-width="3" />`}}),t}renderParticipants(r,t){let e="",i=(n,a)=>{let o=this.normalizeColor(n.participant.color,this.theme.colors.actorFill),c=n.x,s=a?n.y:t.height-this.theme.padding-this.theme.participantHeight-20,l=n.centerX,f=s+this.theme.participantHeight/2,d=(n.participant.label||n.participant.name).replace(/\\n/g,`
`).split(`
`);switch(n.participant.type){case"actor":e+=`<circle cx="${l}" cy="${s+10}" r="8" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${l}" y1="${s+18}" x2="${l}" y2="${s+30}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${l-10}" y1="${s+22}" x2="${l+10}" y2="${s+22}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${l}" y1="${s+30}" x2="${l-8}" y2="${s+40}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${l}" y1="${s+30}" x2="${l+8}" y2="${s+40}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{e+=`<text x="${l}" y="${s+55+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`});break;case"boundary":e+=`<line x1="${l-20}" y1="${f}" x2="${l-10}" y2="${f}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${l-20}" y1="${f-10}" x2="${l-20}" y2="${f+10}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<circle cx="${l}" cy="${f}" r="14" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{e+=`<text x="${l}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`});break;case"control":e+=`<circle cx="${l}" cy="${f}" r="14" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<path d="M ${l+4} ${f-18} L ${l-4} ${f-14} L ${l+4} ${f-10}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{e+=`<text x="${l}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`});break;case"entity":e+=`<circle cx="${l}" cy="${f}" r="14" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${l-14}" y1="${f+14}" x2="${l+14}" y2="${f+14}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{e+=`<text x="${l}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`});break;case"database":let m=34,u=40,p=s,g=l-m/2;e+=`<path d="M ${g} ${p+10} L ${g} ${p+u-10} A 17 8 0 0 0 ${g+m} ${p+u-10} L ${g+m} ${p+10} A 17 8 0 0 0 ${g} ${p+10} M ${g} ${p+10} A 17 8 0 0 1 ${g+m} ${p+10}" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<path d="M ${g} ${p+10} A 17 8 0 0 0 ${g+m} ${p+10}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{e+=`<text x="${l}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`});break;case"collections":let $=34,k=34,D=s+3,E=l-$/2;e+=`<rect x="${E+4}" y="${D-4}" width="${$}" height="${k}" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<rect x="${E}" y="${D}" width="${$}" height="${k}" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{e+=`<text x="${l}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`});break;case"queue":let b=40,L=40,w=s+3,S=l-b/2,R=5,F=L/2;e+=`<path d="M ${S+b} ${w} L ${S} ${w} A ${R} ${F} 0 0 0 ${S} ${w+L} L ${S+b} ${w+L} A ${R} ${F} 0 0 0 ${S+b} ${w}" fill="${o}" stroke="none" />`,e+=`<ellipse cx="${S+b}" cy="${w+F}" rx="${R}" ry="${F}" fill="${o}" stroke="none" />`,e+=`<path d="M ${S+b} ${w} L ${S} ${w} A ${R} ${F} 0 0 0 ${S} ${w+L} L ${S+b} ${w+L}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<ellipse cx="${S+b}" cy="${w+F}" rx="${R}" ry="${F}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{e+=`<text x="${l}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`});break;default:e+=`<rect x="${c}" y="${s}" width="${n.width}" height="${this.theme.participantHeight}" rx="5" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,d.forEach((I,P)=>{let Z=d.length>1?f-(d.length-1)*7.5+P*15:f;e+=`<text x="${l}" y="${Z}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize}" font-weight="bold">${I}</text>`})}};return t.participants.forEach(n=>{n.participant.name==="["||n.participant.name==="]"||(i(n,!0),r.hideFootbox||i(n,!1))}),e}renderGroups(r){let t="";return r.groups.forEach(e=>{t+=`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" fill="none" stroke="#222" stroke-width="2" rx="5" />`,t+=`<path d="M ${e.x} ${e.y} L ${e.x+70} ${e.y} L ${e.x+70} ${e.y+10} L ${e.x+60} ${e.y+20} L ${e.x} ${e.y+20} Z" fill="#eee" stroke="#222" stroke-width="2" />`,t+=`<text x="${e.x+5}" y="${e.y+15}" font-size="${this.theme.fontSize-2}" font-weight="bold">${e.type}</text>`,e.label&&(t+=`<text x="${e.x+75}" y="${e.y+15}" font-size="${this.theme.fontSize-2}" font-weight="bold">[${e.label}]</text>`),e.sections.forEach(i=>{let n=i.y;t+=`<line x1="${e.x}" y1="${n}" x2="${e.x+e.width}" y2="${n}" stroke="#222" stroke-width="1" stroke-dasharray="5,5" />`,t+=`<text x="${e.x+5}" y="${n+15}" font-size="${this.theme.fontSize-2}" font-weight="bold">[${i.label}]</text>`})}),t}renderNotes(r){let t="";return r.notes.forEach(e=>{this.drawNoteShape(t,e.x,e.y,e.width,e.height,e.note.shape,e.note.color,e.note.text),t=this.lastSvg}),t}renderActivations(r,t){let e="";return[...t.activations].sort((n,a)=>n.activation.level-a.activation.level).forEach(n=>{let a=n.activation.color||this.theme.colors.actorFill;e+=`<rect x="${n.x}" y="${n.y}" width="${n.width}" height="${n.height}" fill="${a}" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`}),e}renderReferences(r,t){let e="";return t.references.forEach(i=>{e+=`<rect x="${i.x}" y="${i.y}" width="${i.width}" height="${i.height}" fill="${this.theme.colors.defaultFill}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<path d="M ${i.x} ${i.y} L ${i.x+70} ${i.y} L ${i.x+70} ${i.y+10} L ${i.x+60} ${i.y+20} L ${i.x} ${i.y+20} Z" fill="#eee" stroke="#222" stroke-width="2" />`,e+=`<text x="${i.x+5}" y="${i.y+12}" font-size="${this.theme.fontSize-2}" font-weight="bold">ref</text>`;let n=i.reference.label.split(`
`),a=this.theme.fontSize+2,o=n.length*a,c=25,s=i.y+i.height/2-o/2+a/2;s<i.y+c+a/2&&(s=i.y+c+a/2),n.forEach((l,f)=>{e+=`<text x="${i.x+i.width/2}" y="${s+f*a}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize}">${l}</text>`})}),e}renderMessages(r,t){let e="";return t.messages.forEach(i=>{let n=i.message,a=this.normalizeColor(n.color,this.theme.colors.defaultStroke),o=i.lineStyle==="dashed"?"4":"0",c=a.replace("#",""),s=(u,p)=>{if(u==="none")return"none";let g="";return u==="default"?g=p?`arrowhead-reverse-${c}`:`arrowhead-${c}`:u==="open"?g=p?`arrowhead-open-reverse-${c}`:`arrowhead-open-${c}`:u==="half"?g=p?`halfhead-reverse-${c}`:`halfhead-${c}`:u==="circle"?g=`circlehead-${c}`:u==="arrow-circle"?g=p?`arrowhead-circle-reverse-${c}`:`arrowhead-circle-${c}`:u==="lost"?g=`losthead-${c}`:u==="found"&&(g=`circlehead-${c}`),g?`url(#${g})`:"none"},l=s(n.arrowHead||"default",!1),f=s(n.startHead||(n.bidirectional?"default":"none"),!0);if(i.points.length>2){let u=`M ${i.points.map(p=>`${p.x} ${p.y}`).join(" L ")}`;e+=`<path d="${u}" fill="none" stroke="${a}" stroke-width="1.5" stroke-dasharray="${o}" marker-end="${l}" marker-start="${f}" />`}else{let[u,p]=i.points;e+=`<line x1="${u.x}" y1="${u.y}" x2="${p.x}" y2="${p.y}" stroke="${a}" stroke-width="1.5" stroke-dasharray="${o}" marker-end="${l}" marker-start="${f}" />`}let d=(n.number?`[${n.number}] ${n.text}`:n.text).split(`
`),m=i.points.length>2?"start":"middle";d.forEach((u,p)=>{let $=i.labelPosition.y-(d.length-1-p)*15-5;i.points.length>2&&($=i.labelPosition.y+p*20),e+=`<text x="${i.labelPosition.x}" y="${$}" text-anchor="${m}" font-size="${this.theme.fontSize-2}" fill="${a}">${u}</text>`})}),e}renderDividers(r,t){let e="";return t.dividers.forEach(i=>{let n=i.y;if(e+=`<line x1="${this.theme.padding}" y1="${n}" x2="${t.width-this.theme.padding}" y2="${n}" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`,e+=`<line x1="${this.theme.padding}" y1="${n+4}" x2="${t.width-this.theme.padding}" y2="${n+4}" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`,i.label){let a=i.label.length*9+20;e+=`<rect x="${t.width/2-a/2}" y="${n-10}" width="${a}" height="20" fill="white" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`,e+=`<text x="${t.width/2}" y="${n}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize-2}" font-weight="bold">${i.label}</text>`}}),e}renderDelays(r,t){let e="";return t.delays.forEach(i=>{let n=i.y,a=t.width/2,o=10,c=5;if(i.text){let s=i.text.length*8+20;e+=`<text x="${a}" y="${n}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize}" fill="${this.theme.colors.text}">${i.text}</text>`;for(let l=0;l<c;l++){let f=a-s/2-10-l*o;e+=`<circle cx="${f}" cy="${n}" r="1.5" fill="${this.theme.colors.text}" />`}for(let l=0;l<c;l++){let f=a+s/2+10+l*o;e+=`<circle cx="${f}" cy="${n}" r="1.5" fill="${this.theme.colors.text}" />`}}else for(let s=-10;s<=10;s++)s!==0&&(e+=`<circle cx="${a+s*o}" cy="${n}" r="1.5" fill="${this.theme.colors.text}" />`)}),e}renderTimeConstraints(r){let t="";return r.timeConstraints.forEach(e=>{let i=e.x,n=e.startY,a=e.endY,o=this.theme.colors.defaultStroke;if(t+=`<line x1="${i}" y1="${n}" x2="${i}" y2="${a}" stroke="${o}" stroke-width="1.5" />`,t+=`<polygon points="${i} ${n}, ${i-4} ${n+8}, ${i+4} ${n+8}" fill="${o}" />`,t+=`<polygon points="${i} ${a}, ${i-4} ${a-8}, ${i+4} ${a-8}" fill="${o}" />`,e.label){let c=(n+a)/2;t+=`<text x="${i+10}" y="${c}" text-anchor="start" dominant-baseline="middle" font-size="${this.theme.fontSize-2}" fill="${o}">${e.label}</text>`}}),t}normalizeColor(r,t){return r?r.startsWith("#")?/^#[0-9a-fA-F]{3,8}$/.test(r)?r:r.substring(1):r:t}formatRichText(r){let t=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");return t=t.replace(/\*\*(.*?)\*\*/g,'<tspan font-weight="bold">$1</tspan>'),t=t.replace(/\/\/(.*?)\/\//g,'<tspan font-style="italic">$1</tspan>'),t=t.replace(/""(.*?)""/g,'<tspan font-family="monospace">$1</tspan>'),t=t.replace(/--(.*?)--/g,'<tspan text-decoration="line-through">$1</tspan>'),t=t.replace(/__(.*?)__/g,'<tspan text-decoration="underline">$1</tspan>'),t=t.replace(/~~(.*?)~~/g,'<tspan style="text-decoration: underline; text-decoration-style: wavy">$1</tspan>'),t}drawNoteShape(r,t,e,i,n,a,o,c){let s="",l=this.normalizeColor(o,this.theme.colors.noteFill),f=this.theme.colors.defaultStroke,h=a||"folder";if(h==="hexagon"){let u=[`${t+10},${e}`,`${t+i-10},${e}`,`${t+i},${e+n/2}`,`${t+i-10},${e+n}`,`${t+10},${e+n}`,`${t},${e+n/2}`].join(" ");s+=`<polygon points="${u}" fill="${l}" stroke="${f}" stroke-width="1.5" />`}else if(h==="bubble"){let m=n/2;s+=`<rect x="${t}" y="${e}" width="${i}" height="${n}" rx="${m}" ry="${m}" fill="${l}" stroke="${f}" stroke-width="1.5" />`}else if(h==="rectangle")s+=`<rect x="${t}" y="${e}" width="${i}" height="${n}" fill="${l}" stroke="${f}" stroke-width="1.5" />`;else{let u=`
                M ${t} ${e}
                L ${t+i-10} ${e}
                L ${t+i} ${e+10}
                L ${t+i} ${e+n}
                L ${t} ${e+n}
                Z
            `;s+=`<path d="${u}" fill="${l}" stroke="${f}" stroke-width="1.5" />`;let p=`
                M ${t+i-10} ${e}
                L ${t+i-10} ${e+10}
                L ${t+i} ${e+10}
            `;s+=`<path d="${p}" fill="none" stroke="${f}" stroke-width="1.5" />`}c.split(`
`).forEach((m,u)=>{s+=`<text x="${t+i/2}" y="${e+20+u*20}" text-anchor="middle" font-size="${this.theme.fontSize}" fill="${this.theme.colors.text}">${this.formatRichText(m)}</text>`}),this.lastSvg=r+s}};function nt(q){let r=new tt,t=new it;try{let e=r.parse(q);return t.render(e)}catch(e){let n=(e.message||"Unknown error occurred during parsing").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=800,o=100;return`
            <svg width="${a}" height="${o}" viewBox="0 0 ${a} ${o}" xmlns="http://www.w3.org/2000/svg" style="background: white; font-family: sans-serif;">
                <rect width="100%" height="100%" fill="#ffeeee" stroke="#ff0000" stroke-width="2" />
                <text x="20" y="50" fill="#ff0000" font-size="16" font-weight="bold">${n}</text>
            </svg>
        `.trim()}}function _(q="pre.seeduml"){if(typeof document>"u")return;document.querySelectorAll(q).forEach(t=>{let e=t.textContent||"",i=nt(e),n=document.createElement("div");n.className="seeduml-diagram",n.innerHTML=i,n.style.display="inline-block",t.parentNode?.replaceChild(n,t)})}function lt(q={}){let{startOnLoad:r=!0,selector:t="pre.seeduml"}=q;r&&(typeof document>"u"||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{_(t)}):_(t)))}typeof window<"u"&&(window.seeduml={renderSequenceDiagram:nt,renderAll:_,initialize:lt});var xt={renderSequenceDiagram:nt,renderAll:_,initialize:lt};return $t(yt);})();
